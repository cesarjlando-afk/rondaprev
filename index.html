<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Rondas Preventivas</title>
  <meta name="theme-color" content="#007bff">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Checklist">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png" type="image/png">
  <style>
  body {
    font-family: Arial, sans-serif;
    padding: 5vw;
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    background-color: #f9f9f9;
    margin: 0;
  }

  .container {
    width: 100%;
    max-width: 95vw;
    margin: auto;
    padding: 5vw;
  }

  #login, #checklistPage {
    display: none;
  }

  #login.visible, #checklistPage.visible {
    display: block;
  }

  .item {
    margin-bottom: 6vw;
    border: 1px solid #ccc;
    padding: 4vw;
    border-radius: 5px;
    background-color: #fff;
  }

  .controles, .avaliacao, .descricaoExtra {
    display: none;
    margin-top: 10px;
  }

  .item.checked .controles {
    display: block;
  }

  canvas {
    width: 100%;
    max-width: 300px;
    margin-top: 10px;
    display: none;
  }

  input[type="text"],
  input[type="password"] {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  button {
    margin-top: 10px;
    padding: 12px 24px;
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  button:hover {
    background-color: #0056b3;
  }

  .hora-captura {
    margin-top: 5px;
    font-size: 0.9rem;
    color: #555;
  }

  #dataHoraAtual {
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    margin-bottom: 20px;
    font-weight: bold;
  }

  #blocoCamera {
    margin-top: 20px;
    display: none;
    text-align: center;
  }

  #videoUnico {
    max-height: 250px;
    margin-bottom: 10px;
    width: 100%;
  }

  @media (max-width: 480px) {
    body {
      font-size: 1.1rem;
    }

    .container {
      padding: 6vw;
    }

    button {
      font-size: 1.1rem;
    }
  }
  
    .cabecario {
  background-color: #f0f4f8;
  color: #333;
  padding: 20px;
  text-align: center;
  border-bottom: 1px solid #ccc;
  margin-bottom: 20px;
  font-family: 'Arial', sans-serif;
}

.cabecario h1 {
  font-size: clamp(1.4rem, 4vw, 2rem);
  margin: 0;
}

.cabecario h1 span {
  display: block;
  font-size: clamp(1rem, 3vw, 1.2rem);
  font-weight: normal;
  margin-top: 5px;
}

.cabecario p {
  font-size: clamp(1rem, 2.5vw, 1.2rem);
  margin-top: 10px;
}

</style>
</head>
<body>
  <header class="cabecario">
  <h1>Birmann 29 <span>(Antonio Alves F. Guedes) - B29</span></h1>
  <p>Brig. Faria Lima, 3729 - Itaim Bibi, SÃ£o Paulo - SP</p>
</header>
<div id="login" class="visible">
  <h2>Login de Acesso</h2>
  <label>UsuÃ¡rio:</label><br>
  <input type="text" id="usuario"><br>
  <label>Senha:</label><br>
  <input type="password" id="senha"><br>
  <button onclick="verificarLogin()">Entrar</button>
  <div id="erro" style="color: red; margin-top: 10px;"></div>
</div>

<div id="checklistPage">
  <h2>Ronda Preventiva Bravos B29</h2>
  <div id="dataHoraAtual"></div>
  <button onclick="iniciarRonda()">ğŸš€ Iniciar Ronda</button>

  <div id="checklist">
    <!-- âœ… Itens 1 a 5 -->
    <div class="item" data-id="1">
      <label><input type="checkbox" class="check" onchange="toggleItem(this)"> Casa de MÃ¡quinas Zona Alta</label>
      <div class="controles">
        <button onclick="abrirCamera(1)">ğŸ“¸ Abrir CÃ¢mera</button>
        <canvas id="canvas1"></canvas>
        <div class="hora-captura"></div>
        <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
      </div>
      <div class="avaliacao">
       <button id="btnConforme1" onclick="avaliarItem(this, true)">âœ… Conforme</button>
        <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
      </div>
      <div class="descricaoExtra">
        <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
        <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
      </div>
    </div>

    <div class="item" data-id="2">
      <label><input type="checkbox" class="check" onchange="toggleItem(this)"> Gerador 2</label>
      <div class="controles">
        <button onclick="abrirCamera(2)">ğŸ“¸ Abrir CÃ¢mera</button>
        <canvas id="canvas2"></canvas>
        <div class="hora-captura"></div>
        <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
      </div>
      <div class="avaliacao">
       <button id="btnConforme2" onclick="avaliarItem(this, true)">âœ… Conforme</button> <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
      </div>
      <div class="descricaoExtra">
        <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
        <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
      </div>
    </div>

    <div class="item" data-id="3">
      <label><input type="checkbox" class="check" onchange="toggleItem(this)"> CAG 2</label>
      <div class="controles">
        <button onclick="abrirCamera(3)">ğŸ“¸ Abrir CÃ¢mera</button>
        <canvas id="canvas3"></canvas>
        <div class="hora-captura"></div>
        <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
      </div>
      <div class="avaliacao">
        <button id="btnConforme3" onclick="avaliarItem(this, true)">âœ… Conforme</button>
        <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
      </div>
      <div class="descricaoExtra">
        <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
        <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
      </div>
    </div>

    <div class="item" data-id="4">
      <label><input type="checkbox" class="check" onchange="toggleItem(this)"> DEA</label>
      <div class="controles">
        <button onclick="abrirCamera(4)">ğŸ“¸ Abrir CÃ¢mera</button>
        <canvas id="canvas4"></canvas>
        <div class="hora-captura"></div>
        <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
      </div>
      <div class="avaliacao">
        <button id="btnConforme4" onclick="avaliarItem(this, true)">âœ… Conforme</button>
        <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
      </div>
      <div class="descricaoExtra">
        <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
        <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
      </div>
    </div>

    <div class="item" data-id="5">
      <label><input type="checkbox" class="check" onchange="toggleItem(this)"> PressurizaÃ§Ã£o</label>
      <div class="controles">
        <button onclick="abrirCamera(5)">ğŸ“¸ Abrir CÃ¢mera</button>
        <canvas id="canvas5"></canvas>
        <div class="hora-captura"></div>
        <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
      </div>
      <div class="avaliacao">
        <button id="btnConforme5" onclick="avaliarItem(this, true)">âœ… Conforme</button>
        <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
      </div>
      <div class="descricaoExtra">
        <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
        <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
      </div>
    </div>
    <!-- Item 6: CAG 1 -->
<div class="item" data-id="6">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)"> CAG 1</label>
  <div class="controles">
    <button onclick="abrirCamera(6)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas6"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme6" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>

<!-- Repita a estrutura acima para os itens 7 a 17, alterando o nome e o nÃºmero do ID/canvas -->
<!-- Aqui estÃ£o os nomes para cada item: -->
<!-- 7: 2Â° Subsolo -->
<div class="item" data-id="7">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)"> 2Â° Subsolo</label>
  <div class="controles">
    <button onclick="abrirCamera(7)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas7"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme7" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 8: 3Â° Subsolo -->
<div class="item" data-id="8">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">3Â° Subsolo</label>
  <div class="controles">
    <button onclick="abrirCamera(8)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas8"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme8" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 9: Casa de Bomba Ãgua PotÃ¡vel 4Â°SS -->
<div class="item" data-id="9">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Casa de Bomba Ãgua PotÃ¡vel 4Â°SS</label>
  <div class="controles">
    <button onclick="abrirCamera(9)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas9"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme9" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 10: Casa de Bomba de IncÃªndio -->
<div class="item" data-id="10">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Casa de Bomba de IncÃªndio</label>
  <div class="controles">
    <button onclick="abrirCamera(10)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas10"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme10" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 11: Tanque de Diesel -->
<div class="item" data-id="11">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Tanque de Diesel</label>
  <div class="controles">
    <button onclick="abrirCamera(11)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas11"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme11"onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 12: LenÃ§ol FreÃ¡tico -->
<div class="item" data-id="12">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">LenÃ§ol FreÃ¡tico</label>
  <div class="controles">
    <button onclick="abrirCamera(12)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas12"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme12" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 13: CAG 1 -->
<div class="item" data-id="13">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Heliponto</label>
  <div class="controles">
    <button onclick="abrirCamera(13)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas13"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme13"onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 14: Gerador 1 -->
<div class="item" data-id="14">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Gerador 1</label>
  <div class="controles">
    <button onclick="abrirCamera(14)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas14"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme14" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 15: Registro de Recalque -->
<div class="item" data-id="15">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Registro de Recalque</label>
  <div class="controles">
    <button onclick="abrirCamera(15)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas15"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme15" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 16: Casa de Maquinas Zona Baixa -->
<div class="item" data-id="16">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Casa de Maquinas Zona Baixa</label>
  <div class="controles">
    <button onclick="abrirCamera(16)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas16"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button id="btnConforme16" onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>
<!-- 17: Painel de Controle de IncÃªndio -->
<div class="item" data-id="17">
  <label><input type="checkbox" class="check" onchange="toggleItem(this)">Painel Alarme de IncÃªndio</label>
  <div class="controles">
    <button onclick="abrirCamera(17)">ğŸ“¸ Abrir CÃ¢mera</button>
    <canvas id="canvas17"></canvas>
    <div class="hora-captura"></div>
    <input type="text" placeholder="DescriÃ§Ã£o..." oninput="salvarEstado()">
  </div>
  <div class="avaliacao">
    <button onclick="avaliarItem(this, true)">âœ… Conforme</button>
    <button onclick="avaliarItem(this, false)">âŒ NÃ£o Conforme</button>
  </div>
  <div class="descricaoExtra">
    <input type="text" class="descricaoExtraInput" placeholder="Descreva o problema..." oninput="validarDescricao(this)">
    <button disabled onclick="salvarNaoConforme(this)">ğŸ’¾ Salvar</button>
  </div>
</div>

<!-- Bloco Ãºnico de cÃ¢mera -->
<div id="blocoCamera">
  <video id="videoUnico" autoplay playsinline></video><br>
  <button onclick="capturarFotoUnica()">âœ… Capturar Foto</button>
</div>

<button id="btnPDF" onclick="verificarAntesDeGerar()">ğŸ“„ Gerar PDF</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let streamAtual = null;
let usuarioAtual = "";
let rondaIniciada = false;
let itemAtivo = null;

const usuariosPermitidos = {
  "Cesar Lando": "25242",
  "Cristiano Andrade": "12345"
};

function verificarLogin() {
  const usuario = document.getElementById("usuario").value.trim();
  const senha = document.getElementById("senha").value.trim();
  const erro = document.getElementById("erro");

  if (usuariosPermitidos[usuario] === senha) {
    usuarioAtual = usuario;
    document.getElementById("login").classList.remove("visible");
    document.getElementById("checklistPage").classList.add("visible");
    restaurarEstado();
  } else {
    erro.innerText = "UsuÃ¡rio ou senha invÃ¡lidos.";
  }
}

function toggleItem(checkbox) {
  const item = checkbox.closest('.item');
  if (!rondaIniciada) {
    checkbox.checked = false;
    alert("âš ï¸ Inicie a ronda antes de verificar os itens!");
    return;
  }
  if (checkbox.checked) {
    item.classList.add('checked');
    item.querySelector('.controles').style.display = "block";
  } else {
    item.classList.remove('checked');
    item.querySelector('.controles').style.display = "none";
    item.querySelector('.avaliacao').style.display = "none";
    item.querySelector('.descricaoExtra').style.display = "none";
    item.querySelector('canvas').style.display = "none";
    item.removeAttribute("data-foto");
  }
  verificarChecklistCompleto();
  salvarEstado();
}

function abrirCamera(id) {
  itemAtivo = id;
  const video = document.getElementById("videoUnico");
  const blocoCamera = document.getElementById("blocoCamera");

  navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
    .then(stream => {
      video.srcObject = stream;
      video.style.display = "block";
      blocoCamera.style.display = "block";
      streamAtual = stream;
      setTimeout(() => {
        blocoCamera.scrollIntoView({ behavior: "smooth", block: "center" });
      }, 300);
    })
    .catch(err => {
      alert("Erro ao acessar a cÃ¢mera: " + err.message);
    });
}

function capturarFotoUnica() {
  if (!itemAtivo) return;

  const video = document.getElementById("videoUnico");
  const canvas = document.getElementById(`canvas${itemAtivo}`);
  const ctx = canvas.getContext('2d');
  canvas.style.display = "block";
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  const hora = new Date().toLocaleString();
  const item = document.querySelector(`.item[data-id="${itemAtivo}"]`);
  item.querySelector('.hora-captura').innerText = `Capturado em: ${hora}`;
  item.setAttribute("data-foto", "true");

  if (streamAtual) {
    streamAtual.getTracks().forEach(track => track.stop());
    streamAtual = null;
    video.style.display = "none";
    document.getElementById("blocoCamera").style.display = "none";
  }

  item.querySelector('.controles').style.display = "none";
  item.querySelector('.avaliacao').style.display = "block";
  item.querySelector('input[type="text"]').style.display = "none";

  verificarChecklistCompleto();

  // ğŸ”„ Rolar atÃ© o botÃ£o "âœ… Conforme"
  const btnConforme = document.getElementById(`btnConforme${itemAtivo}`);
  if (btnConforme) {
    setTimeout(() => {
      btnConforme.scrollIntoView({ behavior: "smooth", block: "center" });
    }, 300);
  }
}

function validarDescricao(input) {
  const btnSalvar = input.nextElementSibling;
  btnSalvar.disabled = input.value.trim() === "";
}

function salvarNaoConforme(btn) {
  const item = btn.closest('.item');
  const extraInput = item.querySelector('.descricaoExtraInput');
  const descricaoInput = item.querySelector('input[type="text"]');
  descricaoInput.value = extraInput.value.trim();

  salvarEstado();
  item.classList.remove('checked');
  item.querySelector('.descricaoExtra').style.display = "none";
  item.querySelector('.controles').style.display = "block";
  descricaoInput.style.display = "block";
}

function salvarNaoConforme(btn) {
  const item = btn.closest('.item');
  const extraInput = item.querySelector('.descricaoExtraInput');
  const descricaoInput = item.querySelector('input[type="text"]');
  descricaoInput.value = extraInput.value.trim();

  salvarEstado();
  item.classList.remove('checked');
  item.querySelector('.descricaoExtra').style.display = "none";
  item.querySelector('.controles').style.display = "block";
  descricaoInput.style.display = "block";
}

function verificarChecklistCompleto() {
  const itens = document.querySelectorAll('.item');
  const todosVerificados = Array.from(itens).every(item => item.querySelector('.check').checked);
  const todasFotosCapturadas = Array.from(itens).every(item => item.getAttribute("data-foto") === "true");

  const btnPDF = document.getElementById("btnPDF");
  btnPDF.disabled = !(todosVerificados && todasFotosCapturadas);
}
// ğŸ”¹ MantÃ©m o botÃ£o SEMPRE ativo
function verificarChecklistCompleto() {
  const btnPDF = document.getElementById("btnPDF");
  btnPDF.disabled = false; // sempre habilitado
}

// ğŸ”¹ SÃ³ gera PDF se todos os itens estiverem verificados
function verificarAntesDeGerar() {
  const itens = document.querySelectorAll('.item');
  let todosValidos = true;

  itens.forEach((item) => {
    const checkbox = item.querySelector('.check');
    const descricao = item.querySelector('.controles input[type="text"]');
    const canvas = item.querySelector('canvas');

    const marcado = checkbox?.checked;
    const texto = descricao?.value.trim();
    const temFoto = canvas && canvas.width > 0;

    if (!marcado || !texto || !temFoto) {
      todosValidos = false;
      item.style.border = "2px solid red";

      // Remove o border vermelho apÃ³s 8 segundos
      setTimeout(() => {
        item.style.border = "1px solid #ccc";
      }, 8000);

    } else {
      item.style.border = "1px solid #ccc";
    }
  });

  if (!todosValidos) {
    alert("âš ï¸ Para gerar o PDF, todos os itens precisam estar verificados, com descriÃ§Ã£o e foto.");
    return;
  }

  // Se passou na validaÃ§Ã£o, chama a funÃ§Ã£o para gerar o PDF
  gerarPDF();
}


function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(14);
  doc.text("RelatÃ³rio de Ronda Preventiva", 10, 10);
  doc.setFontSize(10);
  doc.text(`ResponsÃ¡vel: ${usuarioAtual}`, 10, 20);
  doc.text(`Data: ${new Date().toLocaleString()}`, 10, 26);

  let y = 40;
  document.querySelectorAll('.item').forEach((item, i) => {
    const nome = item.querySelector('label').innerText;
    const descricao = item.querySelector('input[type="text"]').value.trim();
    const canvas = item.querySelector('canvas');

    doc.text(`${i + 1}. ${nome}`, 10, y);
    y += 6;
    doc.text(`DescriÃ§Ã£o: ${descricao || '---'}`, 10, y);
    y += 6;

    if (canvas && canvas.width > 0) {
      const imgData = canvas.toDataURL('image/jpeg', 0.6);
      doc.addImage(imgData, 'JPEG', 10, y, 60, 45);
      y += 50;
    }

    y += 8;
    if (y > 270) {
      doc.addPage();
      y = 20;
    }
  });

  const nomeArquivo = `Ronda_${usuarioAtual}_${new Date().toLocaleDateString()}_${new Date().getTime()}.pdf`;
  doc.save(nomeArquivo);

  alert(`âœ… PDF salvo com sucesso como "${nomeArquivo}"!`);
}


function iniciarRonda() {
  if (confirm("Tem certeza que deseja iniciar uma nova ronda?.")) {
    localStorage.removeItem(`checklist_${usuarioAtual}`);
    rondaIniciada = true;

    document.querySelectorAll('.item').forEach(item => {
      item.classList.remove('checked');
      item.querySelector('.check').checked = false;
      item.querySelector('input[type="text"]').value = "";
      item.querySelector('.hora-captura').innerText = "";
      item.querySelector('canvas').style.display = "none";
      item.querySelector('.controles').style.display = "none";
      item.querySelector('.avaliacao').style.display = "none";
      item.querySelector('.descricaoExtra').style.display = "none";
      item.querySelector('input[type="text"]').style.display = "block";
      item.removeAttribute("data-foto");
    });

    alert("âœ… Ronda iniciada com sucesso!");
    verificarChecklistCompleto();
  }
}

function salvarEstado() {
  const itens = document.querySelectorAll('.item');
  const dados = [];

  itens.forEach((item) => {
    const check = item.querySelector('.check').checked;
    const descricao = item.querySelector('input[type="text"]').value;
    const hora = item.querySelector('.hora-captura')?.innerText || "";
    const foto = item.getAttribute("data-foto") === "true";

    dados.push({ check, descricao, hora, foto });
  });

  localStorage.setItem(`checklist_${usuarioAtual}`, JSON.stringify(dados));
}

function restaurarEstado() {
  const dados = JSON.parse(localStorage.getItem(`checklist_${usuarioAtual}`) || '[]');
  const itens = document.querySelectorAll('.item');

  dados.forEach((dado, index) => {
    const item = itens[index];
    if (!item) return;

    item.querySelector('.check').checked = dado.check;
    item.querySelector('input[type="text"]').value = dado.descricao;
    item.querySelector('.hora-captura').innerText = dado.hora || "";

    if (dado.check) item.classList.add('checked');
    if (dado.foto) item.setAttribute("data-foto", "true");
  });

  verificarChecklistCompleto();
}

function avaliarItem(btn, conforme) {
  const item = btn.closest('.item');
  const descricaoInput = item.querySelector('input[type="text"]');

  if (conforme) {
    descricaoInput.value = "Conforme";
    salvarEstado();
    item.classList.remove('checked');
    item.querySelector('.avaliacao').style.display = "none";
    item.querySelector('.controles').style.display = "block";
    descricaoInput.style.display = "block";
  } else {
    item.querySelector('.avaliacao').style.display = "none";
    item.querySelector('.descricaoExtra').style.display = "block";
  }
}
function atualizarDataHora() {
  const agora = new Date();
  const formatado = agora.toLocaleString('pt-BR', {
    weekday: 'long',
    day: '2-digit',
    month: 'long',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  document.getElementById("dataHoraAtual").innerText = `ğŸ•’ ${formatado}`;
}

setInterval(atualizarDataHora, 1000);

function verificarLimpezaPeriodica() {
  const chaveTempo = "ultimaLimpeza";
  const agora = Date.now();
  const ultimaLimpeza = parseInt(localStorage.getItem(chaveTempo), 10);

  const dozeHoras = 12 * 60 * 60 * 1000; // 12 horas em milissegundos

  if (!ultimaLimpeza || agora - ultimaLimpeza >= dozeHoras) {
    console.log("ğŸ§¹ Limpando dados salvos apÃ³s 12 horas...");
    Object.keys(localStorage).forEach(key => {
      if (key.startsWith("checklist_")) {
        localStorage.removeItem(key);
      }
    });
    localStorage.setItem(chaveTempo, agora.toString());
  } else {
    const restante = ((dozeHoras - (agora - ultimaLimpeza)) / 3600000).toFixed(1);
    console.log(`â³ PrÃ³xima limpeza em aproximadamente ${restante} horas`);
  }
}

// âœ… Chame essa funÃ§Ã£o ao iniciar o app
verificarLimpezaPeriodica();


  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("âœ… Service Worker registrado com sucesso!"))
      .catch(err => console.log("âŒ Erro ao registrar Service Worker:", err));
  }

</script>
</body>
</html>